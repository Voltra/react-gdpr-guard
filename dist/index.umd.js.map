{"version":3,"file":"index.umd.js","sources":["../src/globalState.ts","../src/ManagerWrapper.ts","../src/SaviorWrapper.ts","../src/index.ts"],"sourcesContent":["import { useEffect, useState, SetStateAction, Dispatch } from \"react\";\n\nexport type StoreUpdater<Store> = (store: Store) => Store;\n\nexport type EmitterSubscription<Store> = (store: Store) => void;\n\nexport type EmitterUnsubscriptionFunction = () => void;\n\nexport type StoreFactory<Store> = () => Store;\n\nexport type StoreHook<Store> = () => [\n\tstore: Store,\n\tsetStore: Dispatch<SetStateAction<Store>>\n];\n\nexport type InitialStoreFactory<Store> = (\n\tget: StoreFactory<Store>,\n\tset: (updater: StoreUpdater<Store>) => Store\n) => Store;\n\nexport interface StoreHolder<Store> {\n\tstore: Store | null;\n}\n\n// cf. https://formidable.com/blog/2021/stores-no-context-api/\n// cf. https://blog.axlight.com/posts/steps-to-develop-global-state-for-react/\n\nexport type CreateGlobalStore<Store> = [\n\tstoreHolder: StoreHolder<Store>,\n\tuseStore: StoreHook<Store>\n];\n\nexport const createGlobalStore = <Store>(\n\tinitialStoreFactory: InitialStoreFactory<Store>\n): CreateGlobalStore<Store> => {\n\tconst storeHolder: StoreHolder<Store> = {\n\t\tstore: null,\n\t};\n\tconst listeners = new Set<() => void>();\n\n\tconst get = () => storeHolder.store!;\n\tconst set = (updater: StoreUpdater<Store>) => {\n\t\tstoreHolder.store = updater(get());\n\t\tlisteners.forEach(listener => listener());\n\t\treturn storeHolder.store;\n\t};\n\n\tstoreHolder.store = initialStoreFactory(get, set);\n\n\tconst setGlobalStore = (\n\t\tnextStore: Store | ((prevStore: Store) => Store)\n\t) => {\n\t\tif (typeof nextStore !== \"function\") {\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tnextStore = () => nextStore as Store;\n\t\t}\n\n\t\tset(nextStore as (prevStore: Store) => Store);\n\t};\n\n\tconst useLocalStore: StoreHook<Store> = () => {\n\t\t// intitialize component with latest store\n\t\tconst [localStore, setLocalStore] = useState<Store>(get());\n\n\t\t// update our local store when the global\n\t\t// store updates.\n\t\t//\n\t\t// emitter.subscribe returns a cleanup\n\t\t// function, so react will clean this\n\t\t// up on unmount.\n\t\tuseEffect(() => {\n\t\t\tconst listener = () => {\n\t\t\t\tsetLocalStore(get());\n\t\t\t};\n\n\t\t\tlisteners.add(listener);\n\t\t\tlistener(); // in case it's already changed\n\t\t\treturn () => {\n\t\t\t\tlisteners.delete(listener);\n\t\t\t};\n\t\t}, []);\n\t\treturn [localStore, setGlobalStore];\n\t};\n\n\treturn [storeHolder, useLocalStore];\n};\n","import type {\n\tGdprManager,\n\tGdprManagerRaw,\n\tGdprGuard,\n\tGdprGuardGroup,\n\tGdprStorage,\n\tGdprManagerEventHub,\n} from \"gdpr-guard\";\n\nimport { StoreHolder } from \"./globalState\";\nimport type { MethodNamesOf } from \"./typings\";\nimport { ArgumentsOf } from \"./typings\";\n\nexport interface ReactGdprGuardGlobalStore {\n\tmaterializedState: GdprManagerRaw;\n\tupdate(manager: GdprManagerRaw): ReactGdprGuardGlobalStore;\n}\n\nexport class ManagerWrapper {\n\t/* eslint-disable no-useless-constructor, no-empty-function */\n\tconstructor(\n\t\tprotected _manager: GdprManager,\n\t\tprotected _globalStoreHolder: StoreHolder<ReactGdprGuardGlobalStore>\n\t) {}\n\t/* eslint-enable no-useless-constructor, no-empty-function */\n\n\tpublic get manager(): GdprManager {\n\t\treturn this._manager;\n\t}\n\n\tpublic get materializedState(): GdprManagerRaw {\n\t\treturn this._globalStoreHolder.store!.materializedState;\n\t}\n\n\tpublic triggerUpdate(): void {\n\t\tthis._globalStoreHolder.store!.update(this.generateRawManager());\n\t}\n\n\tpublic get bannerWasShown(): boolean {\n\t\treturn this.manager.bannerWasShown;\n\t}\n\n\tpublic get events(): GdprManagerEventHub {\n\t\treturn this.manager.events;\n\t}\n\n\tpublic closeBanner(): void {\n\t\tthis.manager.closeBanner();\n\t\tthis.triggerUpdate();\n\t}\n\n\tpublic resetAndShowBanner(): void {\n\t\tthis.manager.resetAndShowBanner();\n\t\tthis.triggerUpdate();\n\t}\n\n\tpublic json(): GdprManagerRaw {\n\t\treturn this.materializedState;\n\t}\n\n\tpublic toString(): string {\n\t\treturn JSON.stringify(this.materializedState);\n\t}\n\n\tpublic disable(target?: string): this {\n\t\treturn this.wrap(\"disable\", target);\n\t}\n\n\tpublic enable(target?: string): this {\n\t\treturn this.wrap(\"enable\", target);\n\t}\n\n\tpublic toggle(target?: string): this {\n\t\treturn this.wrap(\"toggle\", target);\n\t}\n\n\tpublic disableForStorage(storageType: GdprStorage): this {\n\t\tthis.manager.disableForStorage(storageType);\n\t\treturn this;\n\t}\n\n\tpublic enableForStorage(storageType: GdprStorage): this {\n\t\tthis.manager.enableForStorage(storageType);\n\t\treturn this;\n\t}\n\n\tpublic toggleForStorage(storageType: GdprStorage): this {\n\t\tthis.manager.toggleForStorage(storageType);\n\t\treturn this;\n\t}\n\n\tpublic isEnabled(name: string): boolean {\n\t\treturn this.manager.isEnabled(name);\n\t}\n\n\tpublic hasGroup(groupName: string): boolean {\n\t\treturn this.manager.hasGroup(groupName);\n\t}\n\n\tpublic hasGuard(guardName: string): boolean {\n\t\treturn this.manager.hasGuard(guardName);\n\t}\n\n\tpublic getGroup(groupName: string): GdprGuardGroup | null {\n\t\treturn this.manager.getGroup(groupName);\n\t}\n\n\tpublic getGuard(guardName: string): GdprGuard | null {\n\t\treturn this.manager.getGuard(guardName);\n\t}\n\n\tprotected generateRawManager(): GdprManagerRaw {\n\t\treturn this.manager.raw();\n\t}\n\n\tpublic hotswap(newManager: GdprManager): this {\n\t\tthis._manager = newManager;\n\t\tthis.triggerUpdate();\n\t\treturn this;\n\t}\n\n\tprotected wrap<Method extends MethodNamesOf<GdprGuard>>(\n\t\tmethod: Method,\n\t\ttarget?: string,\n\t\t...args: ArgumentsOf<GdprGuard[Method]>\n\t): this {\n\t\tif (\n\t\t\ttypeof target === \"undefined\" &&\n\t\t\ttypeof this.manager[method] === \"function\"\n\t\t) {\n\t\t\t// @ts-expect-error False positive of TS2349 or TS2684\n\t\t\tthis.manager[method](...args);\n\t\t\tthis.triggerUpdate();\n\t\t} else if (this.manager.hasGuard(target!)) {\n\t\t\tconst guard = this.manager.getGuard(target!);\n\n\t\t\tif (typeof guard?.[method] === \"function\") {\n\t\t\t\t// @ts-expect-error False positive of TS2349 or TS2684\n\t\t\t\tguard?.[method](...args);\n\t\t\t\tthis.triggerUpdate();\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n}\n","import {\n\tGdprSavior,\n\tGdprManager,\n\tGdprManagerFactory,\n\tGdprManagerRaw,\n\tGdprSaviorAdapter,\n} from \"gdpr-guard\";\n\nimport { ManagerWrapper } from \"./ManagerWrapper\";\n\nexport class SaviorWrapper extends GdprSaviorAdapter {\n\tconstructor(\n\t\tprotected savior: GdprSavior,\n\t\tprotected managerWrapper: ManagerWrapper\n\t) {\n\t\tsuper();\n\t}\n\n\tpublic override async updateSharedManager(\n\t\tmanager: GdprManager\n\t): Promise<void> {\n\t\tif (this.managerWrapper.manager === manager) return;\n\n\t\tawait this.savior.updateSharedManager(manager);\n\t\tthis.managerWrapper.hotswap(manager);\n\t}\n\n\t/// Delegates\n\tpublic override check() {\n\t\treturn this.savior.check();\n\t}\n\n\tpublic override exists(shouldUpdate = true) {\n\t\treturn this.savior.exists(shouldUpdate);\n\t}\n\n\tpublic override restore(shouldUpdate = true) {\n\t\treturn this.savior.restore(shouldUpdate);\n\t}\n\n\tpublic override restoreOrCreate(factory: GdprManagerFactory) {\n\t\treturn this.savior.restoreOrCreate(factory);\n\t}\n\n\tpublic override store(manager: GdprManagerRaw) {\n\t\treturn this.savior.store(manager);\n\t}\n\n\tpublic override decorate(manager: GdprManager): GdprManager {\n\t\tif (typeof this.savior.decorate !== \"undefined\") {\n\t\t\treturn this.savior.decorate(manager);\n\t\t}\n\n\t\treturn super.decorate(manager);\n\t}\n}\n","import type {\n\tGdprManagerFactory,\n\tGdprManagerRaw,\n\tGdprSavior,\n\tGdprGuardRaw,\n\tGdprStorage,\n} from \"gdpr-guard\";\nimport { GdprManager } from \"gdpr-guard\";\nimport {\n\tDependencyList,\n\tuseRef,\n\tuseCallback,\n\tuseMemo,\n\tuseEffect,\n\tuseDebugValue,\n} from \"react\";\n\nimport { createGlobalStore } from \"./globalState\";\nimport { ManagerWrapper, ReactGdprGuardGlobalStore } from \"./ManagerWrapper\";\nimport { SaviorWrapper } from \"./SaviorWrapper\";\nimport type {\n\tGdprGuardHooks,\n\tUseGdpr,\n\tUseSetupGdprEffect,\n\tUseGdprComputed,\n\tUseGdprGuard,\n\tUseGdprGuardEnabledState,\n\tUseGdprManager,\n\tUseGdprSavior,\n\tUseAttachGdprListenersEffect,\n} from \"./typings\";\n\n/**\n * {@link useEffect} but that will only be triggered after one render/call attempt as already been made\n */\nconst useEffectOnSecondRender = <Fn extends (...args: any[]) => any>(\n\tfn: Fn,\n\tdeps: DependencyList = []\n) => {\n\tconst didMount = useRef(false);\n\n\tuseEffect(() => {\n\t\tif (didMount.current) {\n\t\t\tfn();\n\t\t\treturn;\n\t\t}\n\t\tdidMount.current = true;\n\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [...deps, fn]);\n};\n\n/**\n * Create hooks for the gdpr-guard library based on the provided {@link GdprSavior}\n * @param savior - The {@link GdprSavior} to wrap\n * @param managerFactory - A factory to the latest version of your {@link GdprManager}\n * @returns The React hooks associated to that {@link GdprSavior}\n */\nexport const createGdprGuardHooks = (\n\tsavior: GdprSavior,\n\tmanagerFactory: GdprManagerFactory\n): GdprGuardHooks => {\n\t// Use a dummy manager that'll be hotswap later after init\n\tconst dummyManager = GdprManager.create([]);\n\tconst [globalStoreHolder, useGlobalStore] =\n\t\tcreateGlobalStore<ReactGdprGuardGlobalStore>((get, set) => ({\n\t\t\tmaterializedState: dummyManager.raw(),\n\t\t\tupdate: (manager: GdprManagerRaw) => {\n\t\t\t\treturn set(store => ({ ...store, materializedState: manager }));\n\t\t\t},\n\t\t}));\n\n\tconst [, useUnderlyingManager] = createGlobalStore(() => dummyManager);\n\n\tconst managerWrapper = new ManagerWrapper(dummyManager, globalStoreHolder);\n\n\tconst saviorWrapper = new SaviorWrapper(savior, managerWrapper);\n\n\tconst useGdprSavior: UseGdprSavior = (): GdprSavior => saviorWrapper;\n\n\tconst useGdprManager: UseGdprManager = (): ManagerWrapper => managerWrapper;\n\n\t/**\n\t * For internal uses only\n\t */\n\tconst useWrappedManager = () => {\n\t\tconst [store] = useGlobalStore();\n\t\treturn useMemo(() => store.materializedState, [store]);\n\t};\n\n\tconst useSetupGdprEffect: UseSetupGdprEffect = onError => {\n\t\tconst wrappingManager = useGdprManager();\n\t\tconst [underlyingManager, setUnderlyingManager] = useUnderlyingManager();\n\t\tconst lastAutoClose = useRef<GdprManager|undefined>();\n\n\t\tconst restoreManagerOnBoot = useCallback(() => {\n\t\t\t(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst manager = await saviorWrapper.restoreOrCreate(\n\t\t\t\t\t\tmanagerFactory\n\t\t\t\t\t);\n\n\t\t\t\t\twrappingManager.hotswap(manager);\n\t\t\t\t\tsetUnderlyingManager(manager);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tonError?.(e);\n\t\t\t\t}\n\t\t\t})();\n\n\t\t\treturn () => {};\n\t\t}, [onError, wrappingManager]);\n\n\t\tuseEffectOnSecondRender(restoreManagerOnBoot);\n\n\t\t// Auto-close\n\t\tuseEffect(() => {\n\t\t\tif (lastAutoClose.current !== underlyingManager && wrappingManager.bannerWasShown) {\n\t\t\t\tlastAutoClose.current =  wrappingManager.manager;\n\t\t\t\twrappingManager.closeBanner();\n\t\t\t}\n\t\t}, [underlyingManager, wrappingManager]);\n\t};\n\n\tconst useGdprComputed: UseGdprComputed = <T>(\n\t\tfactory: () => T,\n\t\tdeps: DependencyList = []\n\t): T => {\n\t\tconst globalStore = useGlobalStore();\n\n\t\treturn useMemo(factory, [...deps, factory, globalStore /*, fn*/]);\n\t};\n\n\tconst useAttachGdprListenersEffect: UseAttachGdprListenersEffect =\n\t\tcallback => {\n\t\t\tconst manager = useGdprManager();\n\t\t\tconst [underlyingManager] = useUnderlyingManager();\n\n\t\t\tuseEffect(() => {\n\t\t\t\treturn callback(manager.events, underlyingManager || manager.manager);\n\t\t\t}, [callback, manager.events, manager.manager, underlyingManager]);\n\t\t};\n\n\tconst useGdprGuardEnabledState: UseGdprGuardEnabledState = (\n\t\tguardName: string,\n\t\tuseBannerStatus: boolean = false\n\t) => {\n\t\treturn useGdprComputed(() => {\n\t\t\tconst bannerWasShown =\n\t\t\t\t!useBannerStatus || managerWrapper.bannerWasShown;\n\n\t\t\treturn (\n\t\t\t\tbannerWasShown &&\n\t\t\t\t(managerWrapper.getGuard(guardName)?.enabled ?? false)\n\t\t\t);\n\t\t}, [guardName, managerWrapper.bannerWasShown]);\n\t};\n\n\tconst useGdprGuard: UseGdprGuard = (guardName: string) => {\n\t\tconst manager = useGdprManager();\n\n\t\tconst guard = useGdprComputed(() => {\n\t\t\treturn manager.getGuard(guardName)?.raw();\n\t\t}, [guardName, manager]) as GdprGuardRaw | null;\n\n\t\tconst enableGuard = useCallback(() => {\n\t\t\tmanager.enable(guardName);\n\t\t}, [guardName, manager]);\n\n\t\tconst disableGuard = useCallback(() => {\n\t\t\tmanager.disable(guardName);\n\t\t}, [guardName, manager]);\n\n\t\tconst toggleGuard = useCallback(() => {\n\t\t\tmanager.toggle(guardName);\n\t\t}, [guardName, manager]);\n\n\t\tuseDebugValue(guardName);\n\n\t\treturn {\n\t\t\tguard,\n\t\t\tenableGuard,\n\t\t\tdisableGuard,\n\t\t\ttoggleGuard,\n\t\t};\n\t};\n\n\tconst useGdpr: UseGdpr = () => {\n\t\tconst wrapper = useGdprManager();\n\n\t\t// Manager\n\t\tconst manager = useGdprComputed(\n\t\t\t() => wrapper.materializedState,\n\t\t\t[wrapper, wrapper.materializedState]\n\t\t);\n\n\t\tconst enableManager = useCallback(() => {\n\t\t\twrapper.enable();\n\t\t}, [wrapper]);\n\n\t\tconst disableManager = useCallback(() => {\n\t\t\twrapper.disable();\n\t\t}, [wrapper]);\n\n\t\tconst toggleManager = useCallback(() => {\n\t\t\twrapper.toggle();\n\t\t}, [wrapper]);\n\n\t\t// Guard/group\n\t\tconst enableGuard = useCallback(\n\t\t\t(guardName: string) => {\n\t\t\t\twrapper.enable(guardName);\n\t\t\t},\n\t\t\t[wrapper]\n\t\t);\n\n\t\tconst disableGuard = useCallback(\n\t\t\t(guardName: string) => {\n\t\t\t\twrapper.disable(guardName);\n\t\t\t},\n\t\t\t[wrapper]\n\t\t);\n\n\t\tconst toggleGuard = useCallback(\n\t\t\t(guardName: string) => {\n\t\t\t\twrapper.toggle(guardName);\n\t\t\t},\n\t\t\t[wrapper]\n\t\t);\n\n\t\tconst guardIsEnabled = useCallback(\n\t\t\t(guardName: string, useBannerStatus: boolean = false) => {\n\t\t\t\tconst bannerWasShown =\n\t\t\t\t\t!useBannerStatus || wrapper.bannerWasShown;\n\t\t\t\treturn bannerWasShown && wrapper.isEnabled(guardName);\n\t\t\t},\n\t\t\t[wrapper]\n\t\t);\n\n\t\t// Storage\n\t\tconst enableForStorage = useCallback(\n\t\t\t(storage: GdprStorage) => {\n\t\t\t\twrapper.enableForStorage(storage);\n\t\t\t},\n\t\t\t[wrapper]\n\t\t);\n\n\t\tconst disableForStorage = useCallback(\n\t\t\t(storage: GdprStorage) => {\n\t\t\t\twrapper.disableForStorage(storage);\n\t\t\t},\n\t\t\t[wrapper]\n\t\t);\n\n\t\tconst toggleForStorage = useCallback(\n\t\t\t(storage: GdprStorage) => {\n\t\t\t\twrapper.toggleForStorage(storage);\n\t\t\t},\n\t\t\t[wrapper]\n\t\t);\n\n\t\tconst closeGdprBanner = useCallback(\n\t\t\t() => wrapper.closeBanner(),\n\t\t\t[wrapper]\n\t\t);\n\t\tconst resetAndShowBanner = useCallback(\n\t\t\t() => wrapper.resetAndShowBanner(),\n\t\t\t[wrapper]\n\t\t);\n\t\tconst bannerWasShown = useGdprComputed(\n\t\t\t() => wrapper.bannerWasShown,\n\t\t\t[wrapper]\n\t\t);\n\n\t\treturn {\n\t\t\t// Meta\n\t\t\tcloseGdprBanner,\n\t\t\tresetAndShowBanner,\n\t\t\tbannerWasShown,\n\t\t\t// Manager\n\t\t\tmanager,\n\t\t\tenableManager,\n\t\t\tdisableManager,\n\t\t\ttoggleManager,\n\t\t\t// Guard/group\n\t\t\tenableGuard,\n\t\t\tdisableGuard,\n\t\t\ttoggleGuard,\n\t\t\tguardIsEnabled,\n\t\t\t// Storage\n\t\t\tenableForStorage,\n\t\t\tdisableForStorage,\n\t\t\ttoggleForStorage,\n\t\t};\n\t};\n\n\treturn {\n\t\tuseSetupGdprEffect,\n\t\tuseAttachGdprListenersEffect,\n\n\t\tuseGdprSavior,\n\t\tuseGdprManager,\n\t\tuseGdprComputed,\n\n\t\tuseGdprGuardEnabledState,\n\t\tuseGdprGuard,\n\t\tuseGdpr,\n\t};\n};\n"],"names":["createGlobalStore","initialStoreFactory","storeHolder","store","listeners","Set","get","set","updater","forEach","listener","setGlobalStore","nextStore","_useState","useState","localStore","setLocalStore","useEffect","add","ManagerWrapper","_manager","_globalStoreHolder","this","_proto","prototype","triggerUpdate","update","generateRawManager","closeBanner","manager","resetAndShowBanner","json","materializedState","toString","JSON","stringify","disable","target","wrap","enable","toggle","disableForStorage","storageType","enableForStorage","toggleForStorage","isEnabled","name","hasGroup","groupName","hasGuard","guardName","getGroup","getGuard","raw","hotswap","newManager","method","_this$manager","args","slice","call","arguments","apply","guard","key","bannerWasShown","events","SaviorWrapper","_GdprSaviorAdapter","savior","managerWrapper","_this","updateSharedManager","_this2","Promise","resolve","then","e","reject","check","exists","shouldUpdate","restore","restoreOrCreate","factory","decorate","GdprSaviorAdapter","managerFactory","dummyManager","GdprManager","create","_createGlobalStore","_extends","globalStoreHolder","useGlobalStore","useUnderlyingManager","saviorWrapper","useGdprManager","useGdprComputed","deps","globalStore","useMemo","concat","useSetupGdprEffect","onError","wrappingManager","_useUnderlyingManager","underlyingManager","setUnderlyingManager","lastAutoClose","useRef","fn","didMount","current","useEffectOnSecondRender","useCallback","_temp","_catch","useAttachGdprListenersEffect","callback","useGdprSavior","useGdprGuardEnabledState","useBannerStatus","_managerWrapper$getGu","_managerWrapper$getGu2","enabled","useGdprGuard","_manager$getGuard","enableGuard","disableGuard","toggleGuard","useDebugValue","useGdpr","wrapper","enableManager","disableManager","toggleManager","guardIsEnabled","storage","closeGdprBanner"],"mappings":"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"}