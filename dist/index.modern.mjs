import{GdprSaviorAdapter as e,GdprManager as r}from"gdpr-guard";import{useState as a,useEffect as t,useRef as n,useCallback as s,useMemo as o,useDebugValue as i}from"react";function g(){return g=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},g.apply(this,arguments)}const u=e=>{let r={store:null};const n=new Set,s=()=>r.store,o=e=>(r.store=e(s()),n.forEach(e=>e()),r.store);r.store=e(s,o);const i=e=>{"function"!=typeof e&&(e=()=>e),o(e)};return[r,()=>{const[e,r]=a(s());return t(()=>{const e=()=>{r(s())};return n.add(e),e(),()=>{n.delete(e)}},[]),[e,i]}]};class l{constructor(e,r){this._manager=void 0,this._globalStoreHolder=void 0,this._manager=e,this._globalStoreHolder=r}get manager(){return this._manager}get materializedState(){return this._globalStoreHolder.store.materializedState}triggerUpdate(){this._globalStoreHolder.store.update(this.generateRawManager())}get bannerWasShown(){return this.manager.bannerWasShown}get events(){return this.manager.events}closeBanner(){this.manager.closeBanner(),this.triggerUpdate()}resetAndShowBanner(){this.manager.resetAndShowBanner(),this.triggerUpdate()}json(){return this.materializedState}toString(){return JSON.stringify(this.materializedState)}disable(e){return this.wrap("disable",e)}enable(e){return this.wrap("enable",e)}toggle(e){return this.wrap("toggle",e)}disableForStorage(e){return this.manager.disableForStorage(e),this}enableForStorage(e){return this.manager.enableForStorage(e),this}toggleForStorage(e){return this.manager.toggleForStorage(e),this}isEnabled(e){return this.manager.isEnabled(e)}hasGroup(e){return this.manager.hasGroup(e)}hasGuard(e){return this.manager.hasGuard(e)}getGroup(e){return this.manager.getGroup(e)}getGuard(e){return this.manager.getGuard(e)}generateRawManager(){return this.manager.raw()}hotswap(e){return this._manager=e,this.triggerUpdate(),this}wrap(e,r,...a){if(void 0===r&&"function"==typeof this.manager[e])this.manager[e](...a),this.triggerUpdate();else if(this.manager.hasGuard(r)){const t=this.manager.getGuard(r);"function"==typeof(null==t?void 0:t[e])&&(null==t||t[e](...a),this.triggerUpdate())}return this}}class d extends e{constructor(e,r){super(),this.savior=void 0,this.managerWrapper=void 0,this.savior=e,this.managerWrapper=r}async updateSharedManager(e){this.managerWrapper.manager!==e&&(await this.savior.updateSharedManager(e),this.managerWrapper.hotswap(e))}check(){return this.savior.check()}exists(e=!0){return this.savior.exists(e)}restore(e=!0){return this.savior.restore(e)}restoreOrCreate(e){return this.savior.restoreOrCreate(e)}store(e){return this.savior.store(e)}}const h=(e,a)=>{const h=r.create([]),[c,p]=u((e,r)=>({materializedState:h.raw(),update:e=>r(r=>g({},r,{materializedState:e}))})),[,b]=u(()=>h),m=new l(h,c),S=new d(e,m),w=()=>m,G=(e,r=[])=>{const a=p();return o(e,[...r,e,a])};return{useSetupGdprEffect:e=>{const r=w(),[o,i]=b(),g=n();((e,r=[])=>{const a=n(!1);t(()=>{a.current?e():a.current=!0},[...r,e])})(s(()=>((async()=>{try{const e=await S.restoreOrCreate(a);r.hotswap(e),i(e)}catch(r){null==e||e(r)}})(),()=>{}),[e,r])),t(()=>{g.current!==o&&r.bannerWasShown&&(g.current=r.manager,r.closeBanner())},[o,r])},useAttachGdprListenersEffect:e=>{const r=w(),[a]=b();t(()=>e(r.events,a||r.manager),[e,r.events,r.manager,a])},useGdprSavior:()=>S,useGdprManager:w,useGdprComputed:G,useGdprGuardEnabledState:(e,r=!1)=>G(()=>{var a,t;return(!r||m.bannerWasShown)&&null!=(a=null==(t=m.getGuard(e))?void 0:t.enabled)&&a},[e,m.bannerWasShown]),useGdprGuard:e=>{const r=w(),a=G(()=>{var a;return null==(a=r.getGuard(e))?void 0:a.raw()},[e,r]),t=s(()=>{r.enable(e)},[e,r]),n=s(()=>{r.disable(e)},[e,r]),o=s(()=>{r.toggle(e)},[e,r]);return i(e),{guard:a,enableGuard:t,disableGuard:n,toggleGuard:o}},useGdpr:()=>{const e=w(),r=G(()=>e.materializedState,[e,e.materializedState]),a=s(()=>{e.enable()},[e]),t=s(()=>{e.disable()},[e]),n=s(()=>{e.toggle()},[e]),o=s(r=>{e.enable(r)},[e]),i=s(r=>{e.disable(r)},[e]),g=s(r=>{e.toggle(r)},[e]),u=s((r,a=!1)=>(!a||e.bannerWasShown)&&e.isEnabled(r),[e]),l=s(r=>{e.enableForStorage(r)},[e]),d=s(r=>{e.disableForStorage(r)},[e]),h=s(r=>{e.toggleForStorage(r)},[e]);return{closeGdprBanner:s(()=>e.closeBanner(),[e]),resetAndShowBanner:s(()=>e.resetAndShowBanner(),[e]),bannerWasShown:G(()=>e.bannerWasShown,[e]),manager:r,enableManager:a,disableManager:t,toggleManager:n,enableGuard:o,disableGuard:i,toggleGuard:g,guardIsEnabled:u,enableForStorage:l,disableForStorage:d,toggleForStorage:h}}}};export{h as createGdprGuardHooks};
//# sourceMappingURL=index.modern.mjs.map
