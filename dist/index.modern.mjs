import{GdprSaviorAdapter as e,GdprManager as r}from"gdpr-guard";import{useState as t,useEffect as a,useMemo as n,useCallback as s,useRef as o}from"react";function i(){return i=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},i.apply(this,arguments)}class g{constructor(e,r){this._manager=void 0,this._globalStoreHolder=void 0,this._manager=e,this._globalStoreHolder=r}get manager(){return this._manager}get materializedState(){return this._globalStoreHolder.store.materializedState}triggerUpdate(){this._globalStoreHolder.store.update(this.generateRawManager())}get bannerWasShown(){return this.manager.bannerWasShown}get events(){return this.manager.events}closeBanner(){this.manager.closeBanner(),this.triggerUpdate()}resetAndShowBanner(){this.manager.resetAndShowBanner(),this.triggerUpdate()}json(){return this.materializedState}toString(){return JSON.stringify(this.materializedState)}disable(e){return this.wrap("disable",e)}enable(e){return this.wrap("enable",e)}toggle(e){return this.wrap("toggle",e)}disableForStorage(e){return this.manager.disableForStorage(e),this}enableForStorage(e){return this.manager.enableForStorage(e),this}toggleForStorage(e){return this.manager.toggleForStorage(e),this}isEnabled(e){return this.manager.isEnabled(e)}hasGroup(e){return this.manager.hasGroup(e)}hasGuard(e){return this.manager.hasGuard(e)}getGroup(e){return this.manager.getGroup(e)}getGuard(e){return this.manager.getGuard(e)}generateRawManager(){return this.manager.raw()}hotswap(e){return this._manager=e,this.triggerUpdate(),this}wrap(e,r,...t){if(void 0===r&&"function"==typeof this.manager[e])this.manager[e](...t),this.triggerUpdate();else if(this.manager.hasGuard(r)){const a=this.manager.getGuard(r);"function"==typeof(null==a?void 0:a[e])&&(null==a||a[e](...t),this.triggerUpdate())}return this}}class u extends e{constructor(e,r){super(),this.savior=void 0,this.managerWrapper=void 0,this.savior=e,this.managerWrapper=r}async updateSharedManager(e){this.managerWrapper.manager!==e&&(await this.savior.updateSharedManager(e),this.managerWrapper.hotswap(e))}check(){return this.savior.check()}exists(e=!0){return this.savior.exists(e)}restore(e=!0){return this.savior.restore(e)}restoreOrCreate(e){return this.savior.restoreOrCreate(e)}store(e){return this.savior.store(e)}}const l=(e,r=[])=>s(e,r),d=(e,r)=>a(r,e),h=(e,s)=>{const h=r.create([]),[c,p]=(e=>{const r=(()=>{const e=new Map;return{emit:r=>e.forEach(e=>e(r)),subscribe:r=>{const t=Symbol();return e.set(t,r),function(){e.delete(t)}}}})(),n={store:null},s=()=>n.store;return n.store=(o=e=>(n.store=e(s()),r.emit(n.store),n.store),{materializedState:h.raw(),update:e=>o(r=>i({},r,{materializedState:e}))}),[n,()=>{const[e,n]=t(s());return a(()=>r.subscribe(n),[]),e}];var o})(),b=new g(h,c),m=new u(e,b),S=()=>b,w=()=>S().manager,G=(e,r=[])=>{const t=p(),a=l(e,r);return n(a,[t,a])};return{useSetupGdprEffect:(e=(e=>{}))=>{const r=S(),t=w();((e,r=[])=>{const t=o(!1);a(()=>{t.current?e():t.current=!0},[...r,e,t])})(l(()=>{(async()=>{try{const e=await m.restoreOrCreate(s);r.hotswap(e)}catch(r){e(r)}})()},[r])),d([t],()=>{r.bannerWasShown&&r.closeBanner()})},useAttachGdprListenersEffect:e=>{const r=w();d([e,r],()=>{const{events:t}=r;e(t,r)})},useGdprSavior:()=>m,useGdprManager:S,useGdprComputed:G,useGdprGuardEnabledState:(e,r=!1)=>G(()=>{var t,a;return(!r||b.bannerWasShown)&&null!=(t=null==(a=b.getGuard(e))?void 0:a.enabled)&&t},[e,b.bannerWasShown]),useGdprGuard:e=>{const r=S();return{guard:G(()=>{var t;return null==(t=r.getGuard(e))?void 0:t.raw()},[e,r]),enableGuard:l(()=>{r.enable(e)},[e,r]),disableGuard:l(()=>{r.disable(e)},[e,r]),toggleGuard:l(()=>{r.toggle(e)},[e,r])}},useGdpr:()=>{const e=S(),r=G(()=>e.materializedState,[e,e.materializedState]),t=l(()=>{e.enable()},[e]),a=l(()=>{e.disable()},[e]),n=l(()=>{e.toggle()},[e]),s=l(r=>{e.enable(r)},[e]),o=l(r=>{e.disable(r)},[e]),i=l(r=>{e.toggle(r)},[e]),g=l((r,t=!1)=>(!t||e.bannerWasShown)&&e.isEnabled(r),[e]),u=l(r=>{e.enableForStorage(r)},[e]),d=l(r=>{e.disableForStorage(r)},[e]),h=l(r=>{e.toggleForStorage(r)},[e]);return{closeGdprBanner:l(()=>e.closeBanner(),[e]),resetAndShowBanner:l(()=>e.resetAndShowBanner(),[e]),bannerWasShown:G(()=>e.bannerWasShown,[e]),manager:r,enableManager:t,disableManager:a,toggleManager:n,enableGuard:s,disableGuard:o,toggleGuard:i,guardIsEnabled:g,enableForStorage:u,disableForStorage:d,toggleForStorage:h}}}};export{h as createGdprGuardHooks};
//# sourceMappingURL=index.modern.mjs.map
